{% extends "layout.html" %}

{% block content %}
<h1 class="mt-4">Weekly Analytics Dashboard</h1>

<!-- Section for Goal Progress Chart -->
<div class="card mb-4">
  <div class="card-header">Goal Progress</div>
  <div class="card-body">
    <canvas id="goalChart" width="400" height="200"></canvas>
  </div>
</div>

<!-- Section for Habit Completion Rates Chart -->
<div class="card mb-4">
  <div class="card-header">Habit Completion Rates</div>
  <div class="card-body">
    <canvas id="habitChart" width="400" height="200"></canvas>
  </div>
</div>

<!-- Section for Mood Distribution Chart -->
<div class="card mb-4">
  <div class="card-header">Mood Distribution</div>
  <div class="card-body">
    <canvas id="moodChart" width="400" height="200"></canvas>
  </div>
</div>

<!-- Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- JavaScript to fetch data and render charts -->
<script>
  fetch('/analytics/data')
    .then(response => response.json())
    .then(data => {
      // Goal Progress Chart
      const goalLabels = Object.keys(data.goal_progress);
      const goalData = Object.values(data.goal_progress).map(status => {
        if (status === 'not started') return 0;
        if (status === 'in progress') return 1;
        if (status === 'completed') return 2;
      });
      new Chart(document.getElementById('goalChart'), {
        type: 'bar',
        data: {
          labels: goalLabels,
          datasets: [{
            label: 'Goal Progress',
            data: goalData,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1,
                callback: function(value) {
                  if (value === 0) return 'Not Started';
                  if (value === 1) return 'In Progress';
                  if (value === 2) return 'Completed';
                }
              }
            }
          }
        }
      });

      // Habit Completion Rates Chart
      const habitLabels = Object.keys(data.habit_completion);
      const habitData = Object.values(data.habit_completion);
      new Chart(document.getElementById('habitChart'), {
        type: 'bar',
        data: {
          labels: habitLabels,
          datasets: [{
            label: 'Habit Completion Rates',
            data: habitData,
            backgroundColor: 'rgba(153, 102, 255, 0.2)',
            borderColor: 'rgba(153, 102, 255, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              max: 7
            }
          }
        }
      });

      // Mood Distribution Chart
      const moodLabels = Object.keys(data.mood_counter);
      const moodData = Object.values(data.mood_counter);
      new Chart(document.getElementById('moodChart'), {
        type: 'pie',
        data: {
          labels: moodLabels,
          datasets: [{
            label: 'Mood Distribution',
            data: moodData,
            backgroundColor: [
              'rgba(255, 99, 132, 0.2)',
              'rgba(54, 162, 235, 0.2)',
              'rgba(255, 206, 86, 0.2)',
              'rgba(75, 192, 192, 0.2)',
              'rgba(153, 102, 255, 0.2)'
            ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true
        }
      });
    });
</script>

{% endblock %}
